<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:composite="http://xmlns.jcp.org/jsf/composite/composite"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>Facelet Title</title>
    </h:head>
    <h:body>
        <ui:composition template="/template/layout.xhtml">
            <ui:define name="content">
                Cadastro de Contatos

                <h:form id="frmBtnComposites">

                    <p:commandLink action="#{contactMB.newPhone}"
                                   class="link"
                                   oncomplete="$('#modalPhone').modal('show');"
                                   update=":cmpPhone:frmAddPhone">
                        Adicionar Contato
                    </p:commandLink>

                    <p:commandLink action="#{contactMB.newEmail}"
                                   class="link"
                                   oncomplete="$('#modalEmail').modal('show');"
                                   update=":cmpEmail:frmAddEmail">
                        Adicionar E-mail
                    </p:commandLink>

                    <p:commandLink action="#{contactMB.newAddress}"
                                   oncomplete="$('#modalAddress').modal('show');"
                                   update=":cmpAddress:frmAddAddress">
                        Adicionar Endereço
                    </p:commandLink>

                </h:form>

                <h:form id="frmCadastro" prependId="false" class="form form-horizontal">

                    <h:inputHidden value="#{contactMB.contact.id}"/>

                    <h:outputLabel for="nome">Nome</h:outputLabel>
                    <h:inputText id="nome" 
                                 required="true"
                                 requiredMessage="Nome Obrigatório"
                                 pt:placeholder="Nome"
                                 onkeyup="this.value = this.value.toUpperCase();"
                                 value="#{contactMB.contact.name}" >
                    </h:inputText>

                    <h:panelGrid id="pnlPhones">
                        <h:dataTable id="tblPhones"
                                     var="phone" 
                                     value="#{contactMB.listPhones}"
                                     rendered="#{!empty contactMB.listPhones}">  
                            <h:inputHidden value="#{phone.id}"></h:inputHidden>
                            <f:facet name="header">
                                Contatos Telefônicos
                            </f:facet>
                            <h:column>
                                <h:outputText value="#{phone.tipo}"></h:outputText>
                            </h:column>
                            <h:column>
                                <h:outputText value="(#{phone.codArea}) #{phone.numero}"></h:outputText>
                            </h:column>
                            <h:column>
                                <p:commandLink id="btnEditPhone" 
                                               update=":cmpPhone:frmAddPhone"
                                               oncomplete="$('#modalPhone').modal('show');"
                                               title="Editar"
                                               immediate="true">
                                    <f:setPropertyActionListener target="#{contactMB.phone}" value="#{phone}"/>
                                </p:commandLink>
                            </h:column>
                            <h:column>
                                <h:commandLink title="Excluir" 
                                               action="#{contactMB.removePhone}">
                                    <f:ajax execute="@this" render=":frmCadastro:pnlPhones"/>
                                    <f:setPropertyActionListener target="#{contactMB.phone}" value="#{phone}"/>
                                </h:commandLink>
                            </h:column>
                        </h:dataTable>
                    </h:panelGrid>

                    <h:panelGrid id="pnlAddress">
                        <h:dataTable id="tblAddress"
                                     var="address" 
                                     value="#{contactMB.listAddress}"
                                     rendered="#{!empty contactMB.listAddress}"> 
                            <h:inputHidden value="#{address.id}"/>
                            <f:facet name="header">
                                Endereço
                            </f:facet>
                            <h:column>
                                <h:outputText value="#{address.typeAddress}"/>
                            </h:column>
                            <h:column>
                                <h:outputText value="#{address.street}, Nº #{address.number} "/>
                            </h:column>
                            <h:column>
                                <p:commandLink immediate="true"
                                               oncomplete="$('#modalAddress').modal('show');"
                                               update=":cmpAddress:frmAddAddress">
                                    <f:setPropertyActionListener target="#{contactMB.address}" value="#{address}"/>
                                </p:commandLink>
                            </h:column>
                            <h:column>
                                <h:commandLink title="Excluir" 
                                               action="#{contactMB.removeAddress}">
                                    <f:ajax execute="@this" render=":frmCadastro:pnlAddress"/>
                                    <f:setPropertyActionListener target="#{contactMB.address}" value="#{address}"/>
                                </h:commandLink>
                            </h:column>
                        </h:dataTable>
                    </h:panelGrid>

                    <h:panelGrid id="pnlEmails">
                        <h:dataTable id="tblEmails"
                                     var="email" 
                                     value="#{contactMB.listEmails}"
                                     rendered="#{!empty contactMB.listEmails}">  
                            <h:inputHidden value="#{email.id}"/>
                            <f:facet name="header">
                                E-mail
                            </f:facet>
                            <h:column>
                                <h:outputText value="#{email.type}"/>
                            </h:column>
                            <h:column>
                                <h:outputText value="#{email.email}"/>
                            </h:column>
                            <h:column>
                                <p:commandLink immediate="true"
                                               oncomplete="$('#modalEmail').modal('show');" 
                                               title="Editar" 
                                               update=":cmpEmail:frmAddEmail">
                                    <f:setPropertyActionListener target="#{contactMB.email}" value="#{email}" />
                                </p:commandLink>
                            </h:column>
                            <h:column>
                                <h:commandLink title="Excluir" 
                                               action="#{contactMB.removeEmail}">
                                    Remover
                                    <f:ajax execute="@this" render=":frmCadastro:pnlEmails"/>
                                    <f:setPropertyActionListener target="#{contactMB.email}" value="#{email}"/>
                                </h:commandLink>
                            </h:column>
                        </h:dataTable>
                    </h:panelGrid>

                </h:form>

                <composite:phone id="cmpPhone"
                                 code="#{contactMB.phone.id}"
                                 type="#{contactMB.phone.tipo}"
                                 codArea="#{contactMB.phone.codArea}"
                                 number="#{contactMB.phone.numero}"
                                 observation="#{contactMB.phone.observacao}"
                                 btnAddText="Adicionar"
                                 btnAddAction="#{contactMB.addPhone}">
                </composite:phone>

                <composite:address id="cmpAddress"
                                   code="#{contactMB.address.id}"
                                   typeAddress="#{contactMB.address.typeAddress}" 
                                   typeStreet="#{contactMB.address.typeStreet}"
                                   street="#{contactMB.address.street}"
                                   number="#{contactMB.address.number}" 
                                   neighbourhood="#{contactMB.address.neighbourhood}"
                                   zipCode="#{contactMB.address.zipCode}"
                                   state="#{contactMB.address.state}"
                                   city="#{contactMB.address.city}"
                                   btnAddText="Adicionar"
                                   btnAddAction="#{contactMB.addAddress}">
                </composite:address> 

                <composite:email id="cmpEmail"
                                 code="#{contactMB.email.id}"
                                 type="#{contactMB.email.type}"
                                 email="#{contactMB.email.email}"
                                 btnAddText="Adicionar"
                                 btnAddAction="#{contactMB.addEmail}">
                </composite:email>

            </ui:define>

        </ui:composition>

    </h:body>
</html>

